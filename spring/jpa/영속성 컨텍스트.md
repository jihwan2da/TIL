# 영속성 컨텍스트 

### 영속성 컨텍스트란?  
```
영속성 컨텍스트란 엔티티를 연구 저장하는 환경이라는 뜻이다.  
이렇게 의미로만은 이해하기 어렵기 때문에 역할에 대해서 설명하겠다.  
영속성 컨텍스트는 애플리케이션과 데이터베이스 사이에서 객체를 보관하는 가상의  
데이터베이스 같은 역할을 한다.  

EntityManager를 통해서 "엔티티를 저장하거나 조회"하면 EntityManager는
영속성 컨텍스트에 엔티티를 보관하고 관리한다.
```

### 엔티티 생명주기  

```
- 비영속(new/transient): 영속성 컨텍스트와 전혀 관계가 없는 상태  
- 영속(managed): 영속성 컨텍스트에 저장된 상태  
- 준영속(detached): 영속성 컨텍스트에 저장되었다가 분리된 상태  
- 삭제(removed): 삭제된 상태  

 예를 들어 설명을 이어가겠다.    
```
- 비영속  
```java 
    Member member = new Member();
```
위의 코드 처럼 엔티티 객체를 new 키워드로 생성하였지만, 아직 영속성  
컨텍스트에 저장하지 않은 상태를 말한다.  

- 영속  
```java
    em.persist(member);
```
엔티티 매니저를 통해서 엔티티를 영속성 컨텍스트에 저장한 상태를 말하며  
영속성 컨텍스트에 의해 관리된다.  

- 준영속  
```java
    // 엔티티를 영속성 컨텍스트에서 분리해 준영속 상태로  
    em.detach(member);  
    // 영속성 콘텍스트를 비워도 관리되던 엔티티는 계속 준영속 상태  
    em.clear;  
    // 영속성 컨텍스트를 종료해도 준영속 상태
    em.close();
```
영속성 컨텍스트에 의해 관리되던 엔티티가 더이상 관리되지 않는 상태를 말한다.    

- 삭제  
```java
    em.remove(member);
```
엔티티를 영속성 컨텍스트와 데이터베이스에서 삭제  

### 영속성 컨텍스트의 장점
```
1. 1차캐시  
2. 동일성 보장   
3. 트랜잭션을 지원하는 쓰기 지연  
4. 변경감지  
5. 지연로딩  
```



